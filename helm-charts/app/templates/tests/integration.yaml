{{- $fqdn := (include "app.fqdn" .) }}
{{- $domain := (include "app.domain" .) }}
apiVersion: v1
kind: Pod
metadata:
  name: "{{ include "app.fullname" . }}-integration-test"
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: integration-tests
      image: "{{ .Values.tests.integration.image }}:{{ .Values.image.tag }}"
      resources: {{ .Values.tests.integration.resources | toJson }}
      env:
        - name: SERVICE_ENDPOINT
          value: "http://{{ include "app.fullname" . }}"
        {{- if .Values.ingress.enabled }}
        - name: INGRESS_ENDPOINT
          value: "https://{{ $fqdn }}"
        {{- end }}
  restartPolicy: Never
